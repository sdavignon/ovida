(()=>{var e={};e.id=260,e.ids=[260],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6370:(e,a,t)=>{"use strict";t.r(a),t.d(a,{GlobalError:()=>i.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c}),t(1016),t(1366),t(9018);var s=t(9234),r=t(7308),n=t(6196),i=t.n(n),l=t(6618),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);t.d(a,o);let c=["",{children:["player",{children:["[runId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,1016)),"/home/dh_rt2c39/ovida/apps/web/app/player/[runId]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,1366)),"/home/dh_rt2c39/ovida/apps/web/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9018,23)),"next/dist/client/components/not-found-error"]}],d=["/home/dh_rt2c39/ovida/apps/web/app/player/[runId]/page.tsx"],u="/player/[runId]/page",h={require:t,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/player/[runId]/page",pathname:"/player/[runId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},7002:(e,a,t)=>{Promise.resolve().then(t.t.bind(t,3185,23))},3573:(e,a,t)=>{Promise.resolve().then(t.bind(t,4544))},4512:(e,a,t)=>{Promise.resolve().then(t.t.bind(t,2369,23)),Promise.resolve().then(t.t.bind(t,2515,23)),Promise.resolve().then(t.t.bind(t,9173,23)),Promise.resolve().then(t.t.bind(t,8906,23)),Promise.resolve().then(t.t.bind(t,4937,23)),Promise.resolve().then(t.t.bind(t,1500,23))},4544:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>c});var s=t(655),r=t(4730),n=t(9722),i=t(818),l=t(5139),o=t.n(l);function c({params:e}){let{runId:a}=e,t=(0,r.useRef)(null),l=(0,r.useRef)(null),c=(0,r.useRef)(!1),[d,u]=(0,r.useState)(null),[h,p]=(0,r.useState)(null),[_,m]=(0,r.useState)([]),[x,y]=(0,r.useState)(0),[g,j]=(0,r.useState)("idle"),[b,f]=(0,r.useState)(null),[v,N]=(0,r.useState)(null),[w,P]=(0,r.useState)([]),[S,C]=(0,r.useState)(!1),[I,k]=(0,r.useState)(null),[$,R]=(0,r.useState)(null),[A,B]=(0,r.useState)(!0),q=(0,r.useCallback)(()=>{l.current&&(clearInterval(l.current),l.current=null),N(null)},[]),M=(0,r.useCallback)(async()=>{let e=t.current;if(e)try{await e.play(),C(!1),j("playing")}catch(e){C(!0),j("idle")}},[]),E=(0,r.useCallback)(async e=>{let t="number"==typeof e?.index?`?index=${e.index}`:"";j("loading"),f(null),q(),c.current=!1,k(null);try{let e=await (0,i.S)(`/v1/runs/${a}/next${t}`,{method:"POST"});u(e.beat),p(e.audio??null),m(e.audio?.urls??[]),y(0),R(null),j(e.audio?.urls?.length?"playing":"decision"),C(!1)}catch(e){f(e instanceof Error?e.message:"Unable to load beat"),j("error")}},[a,q]),T=(0,r.useCallback)((e,a=!1)=>{if(!d||!a&&"decision"!==g)return;q(),c.current=!1,N(null);let t=d.choices.find(a=>a.id===e),s=t?.text??e;R(e),k({choiceText:s,auto:a});let r=`${d.index}-${e}-${Date.now()}`;P(t=>[{id:r,beatIndex:d.index,narration:d.narration,choiceId:e,choiceText:s,auto:a},...t]),j("loading"),m([]),y(0),p(null),f(null),E()},[d,E,g,q]);(0,r.useCallback)(()=>{if(c.current||!d)return;c.current=!0,q(),j("decision");let e=d.choices[0];e&&(N(8),l.current=setInterval(()=>{N(a=>null===a?a:a<=1?(T(e.id,!0),0):a-1)},1e3))},[d,T,q]);let H=(0,r.useMemo)(()=>{switch(g){case"loading":return"Loading next beat…";case"playing":return"Playing narration";case"decision":return"Awaiting decision";case"error":return"Playback interrupted";default:return"Ready"}},[g]),L=d?.choices[0]??null,U=(0,r.useMemo)(()=>_.length?`Segment ${Math.min(x+1,_.length)} of ${_.length}`:null,[_.length,x]);return(0,s.jsxs)("section",{className:o().player,children:[(0,s.jsxs)("header",{className:o().header,children:[(0,s.jsxs)("div",{children:[s.jsx("p",{className:o().eyebrow,children:"Podcast Player"}),(0,s.jsxs)("h2",{children:["Run ",a]})]}),s.jsx("span",{className:o().badge,children:H})]}),(0,s.jsxs)("div",{className:o().actions,children:[s.jsx(n.default,{href:`/replay/${a}`,children:"View Replay"}),s.jsx(n.default,{href:`/room/${a}`,children:"Enter Room"})]}),b&&(0,s.jsxs)("div",{className:o().error,children:[s.jsx("p",{children:b}),"error"===g&&s.jsx("button",{type:"button",onClick:()=>E(),children:"Retry"})]}),(0,s.jsxs)("div",{className:o().layout,children:[s.jsx("article",{className:o().beatCard,children:A?s.jsx("p",{className:o().loading,children:"Preparing the broadcast…"}):d?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:o().beatHeader,children:[(0,s.jsxs)("span",{className:o().beatIndex,children:["Beat ",d.index+1]}),s.jsx("span",{className:o().audioMeta,children:h?.provider?`${h.provider} • ${h.mime}`:"No audio for this beat"})]}),s.jsx("p",{className:o().narration,children:d.narration}),(0,s.jsxs)("div",{className:o().playback,children:[(0,s.jsxs)("div",{className:o().playbackStatus,children:[s.jsx("span",{className:o().indicator,"aria-hidden":!0}),s.jsx("span",{children:U??H})]}),S&&s.jsx("button",{type:"button",onClick:M,className:o().retryButton,children:"Resume audio"})]}),"decision"===g&&d.choices.length>0&&(0,s.jsxs)("div",{className:o().choices,children:[(0,s.jsxs)("p",{className:o().prompt,children:["Decide where the story drifts next.",null!==v&&L&&(0,s.jsxs)("span",{className:o().countdown,children:[" ","Auto-selecting ",s.jsx("strong",{children:L.text})," in ",v,"s"]})]}),s.jsx("div",{className:o().choiceList,children:d.choices.map(e=>(0,s.jsxs)("button",{type:"button",className:`${o().choiceButton} ${$===e.id?o().choiceSelected:""}`,onClick:()=>T(e.id),disabled:"decision"!==g,children:[s.jsx("span",{children:e.text}),L?.id===e.id&&s.jsx("span",{className:o().choiceDefault,children:"Default"})]},e.id))})]}),I&&"loading"===g&&(0,s.jsxs)("p",{className:o().pendingChoice,children:[I.auto?"Default choice selected:":"You selected:"," ",s.jsx("strong",{children:I.choiceText}),". Generating the next beat…"]})]}):s.jsx("p",{className:o().emptyState,children:"No narration yet. Start the Haunted Shore demo to begin the story."})}),(0,s.jsxs)("aside",{className:o().history,children:[s.jsx("h3",{children:"Recent Decisions"}),0===w.length?s.jsx("p",{className:o().historyEmpty,children:"Choices will appear here as the stream progresses."}):s.jsx("ul",{className:o().historyList,children:w.map(e=>(0,s.jsxs)("li",{className:o().historyItem,children:[(0,s.jsxs)("div",{className:o().historyHeader,children:[(0,s.jsxs)("span",{className:o().historyBeat,children:["Beat ",e.beatIndex+1]}),e.auto&&s.jsx("span",{className:o().historyAuto,children:"Auto"})]}),s.jsx("p",{className:o().historyNarration,children:e.narration}),(0,s.jsxs)("p",{className:o().historyChoice,children:["Chosen: ",s.jsx("strong",{children:e.choiceText})]})]},e.id))})]})]}),s.jsx("audio",{ref:t,preload:"auto",className:o().audio})]})}},818:(e,a,t)=>{"use strict";t.d(a,{S:()=>r});let s=process.env.NEXT_PUBLIC_API_ORIGIN??"http://localhost:4000";async function r(e,a){let t=await fetch(`${s}${e}`,{headers:{"Content-Type":"application/json",...a?.headers??{}},...a});if(!t.ok)throw Error(await n(t));if(!a?.skipJson)return await t.json()}async function n(e){try{let a=await e.json();if("string"==typeof a?.message)return a.message}catch(e){}return`Request failed with status ${e.status}`}},9722:(e,a,t)=>{"use strict";t.d(a,{default:()=>r.a});var s=t(3185),r=t.n(s)},4337:e=>{e.exports={shell:"layout_shell__f3jfS",sidebar:"layout_sidebar__SmN0y",title:"layout_title__xPr_H",nav:"layout_nav__O_QL6",main:"layout_main__ABI2k"}},5139:e=>{e.exports={player:"page_player__jgxvQ",header:"page_header__fjUMv",eyebrow:"page_eyebrow___rxJa",badge:"page_badge__auC8c",actions:"page_actions__0o63J",error:"page_error__TBA2l",layout:"page_layout__b9Udv",beatCard:"page_beatCard__HueyH",beatHeader:"page_beatHeader__e0SMJ",beatIndex:"page_beatIndex__j_LR7",audioMeta:"page_audioMeta__gTrqy",narration:"page_narration__eEIA8",playback:"page_playback__XxZwT",playbackStatus:"page_playbackStatus__H_UUI",indicator:"page_indicator__w9pGx",pulse:"page_pulse__nafJa",retryButton:"page_retryButton__UX3re",choices:"page_choices__2w3_q",prompt:"page_prompt___4M25",countdown:"page_countdown__9Fso7",choiceList:"page_choiceList__WyQCY",choiceButton:"page_choiceButton__uXBIU",choiceSelected:"page_choiceSelected__jooSj",choiceDefault:"page_choiceDefault__OV8GX",pendingChoice:"page_pendingChoice__dyywT",loading:"page_loading__Zj0ug",emptyState:"page_emptyState___XYwo",history:"page_history__U2v4V",historyEmpty:"page_historyEmpty__7znLY",historyList:"page_historyList__9sxZy",historyItem:"page_historyItem__UwT20",historyHeader:"page_historyHeader__RCKKw",historyBeat:"page_historyBeat__GgWfZ",historyAuto:"page_historyAuto__ad_U2",historyNarration:"page_historyNarration__mCtxk",historyChoice:"page_historyChoice__nYw1k",audio:"page_audio__TeNMW"}},1366:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>o,metadata:()=>l});var s=t(5858);t(2327);var r=t(3879),n=t(4337),i=t.n(n);let l={title:"Ovida Console",description:"Control demos, review replays, and monitor live rooms."};function o({children:e}){return s.jsx("html",{lang:"en",children:s.jsx("body",{children:(0,s.jsxs)("div",{className:i().shell,children:[(0,s.jsxs)("aside",{className:i().sidebar,children:[s.jsx("h1",{className:i().title,children:"Ovida"}),(0,s.jsxs)("nav",{className:i().nav,children:[s.jsx(r.default,{href:"/",children:"Demo"}),s.jsx(r.default,{href:"/player/demo",children:"Player"}),s.jsx(r.default,{href:"/replay/demo",children:"Replay"}),s.jsx(r.default,{href:"/room/demo",children:"Room"}),s.jsx(r.default,{href:"/admin",children:"Admin"})]})]}),s.jsx("main",{className:i().main,children:e})]})})})}},1016:(e,a,t)=>{"use strict";t.r(a),t.d(a,{$$typeof:()=>i,__esModule:()=>n,default:()=>l});var s=t(9624);let r=(0,s.createProxy)(String.raw`/home/dh_rt2c39/ovida/apps/web/app/player/[runId]/page.tsx`),{__esModule:n,$$typeof:i}=r;r.default;let l=(0,s.createProxy)(String.raw`/home/dh_rt2c39/ovida/apps/web/app/player/[runId]/page.tsx#default`)},2327:()=>{}};var a=require("../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),s=a.X(0,[970],()=>t(6370));module.exports=s})();